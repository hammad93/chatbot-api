{"filter":false,"title":"relay.py","tooltip":"/relay.py","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":50,"column":16},"end":{"row":50,"column":17},"action":"insert","lines":["d"],"id":1950}],[{"start":{"row":50,"column":17},"end":{"row":50,"column":18},"action":"insert","lines":["a"],"id":1951}],[{"start":{"row":50,"column":18},"end":{"row":50,"column":19},"action":"insert","lines":["t"],"id":1952}],[{"start":{"row":50,"column":19},"end":{"row":50,"column":20},"action":"insert","lines":["a"],"id":1953}],[{"start":{"row":50,"column":21},"end":{"row":51,"column":0},"action":"insert","lines":["",""],"id":1954},{"start":{"row":51,"column":0},"end":{"row":51,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":51,"column":4},"end":{"row":51,"column":5},"action":"insert","lines":["p"],"id":1955}],[{"start":{"row":51,"column":5},"end":{"row":51,"column":6},"action":"insert","lines":["y"],"id":1956}],[{"start":{"row":51,"column":6},"end":{"row":51,"column":7},"action":"insert","lines":["t"],"id":1957}],[{"start":{"row":51,"column":6},"end":{"row":51,"column":7},"action":"remove","lines":["t"],"id":1958}],[{"start":{"row":51,"column":5},"end":{"row":51,"column":6},"action":"remove","lines":["y"],"id":1959}],[{"start":{"row":51,"column":5},"end":{"row":51,"column":6},"action":"insert","lines":["u"],"id":1960}],[{"start":{"row":51,"column":6},"end":{"row":51,"column":7},"action":"insert","lines":["t"],"id":1961}],[{"start":{"row":51,"column":7},"end":{"row":51,"column":8},"action":"insert","lines":["."],"id":1962}],[{"start":{"row":51,"column":8},"end":{"row":51,"column":9},"action":"insert","lines":["e"],"id":1963}],[{"start":{"row":51,"column":8},"end":{"row":51,"column":9},"action":"remove","lines":["e"],"id":1964}],[{"start":{"row":51,"column":8},"end":{"row":51,"column":9},"action":"insert","lines":["m"],"id":1965}],[{"start":{"row":51,"column":9},"end":{"row":51,"column":10},"action":"insert","lines":["e"],"id":1966}],[{"start":{"row":51,"column":10},"end":{"row":51,"column":11},"action":"insert","lines":["s"],"id":1967}],[{"start":{"row":51,"column":11},"end":{"row":51,"column":12},"action":"insert","lines":["s"],"id":1968}],[{"start":{"row":51,"column":12},"end":{"row":51,"column":13},"action":"insert","lines":["a"],"id":1969}],[{"start":{"row":51,"column":13},"end":{"row":51,"column":14},"action":"insert","lines":["g"],"id":1970}],[{"start":{"row":51,"column":14},"end":{"row":51,"column":15},"action":"insert","lines":["e"],"id":1971}],[{"start":{"row":51,"column":15},"end":{"row":51,"column":17},"action":"insert","lines":["()"],"id":1972}],[{"start":{"row":51,"column":16},"end":{"row":51,"column":17},"action":"insert","lines":["r"],"id":1973}],[{"start":{"row":51,"column":17},"end":{"row":51,"column":18},"action":"insert","lines":["e"],"id":1974}],[{"start":{"row":51,"column":18},"end":{"row":51,"column":19},"action":"insert","lines":["s"],"id":1975}],[{"start":{"row":51,"column":19},"end":{"row":51,"column":20},"action":"insert","lines":["p"],"id":1976}],[{"start":{"row":51,"column":20},"end":{"row":51,"column":21},"action":"insert","lines":["o"],"id":1977}],[{"start":{"row":51,"column":21},"end":{"row":51,"column":22},"action":"insert","lines":["n"],"id":1978}],[{"start":{"row":51,"column":22},"end":{"row":51,"column":23},"action":"insert","lines":["s"],"id":1979}],[{"start":{"row":51,"column":23},"end":{"row":51,"column":24},"action":"insert","lines":["e"],"id":1980}],[{"start":{"row":51,"column":25},"end":{"row":52,"column":20},"action":"remove","lines":["","    log(data, reply)"],"id":1981}],[{"start":{"row":53,"column":19},"end":{"row":82,"column":25},"action":"remove","lines":["","","'''","PURPOSE: Create a log for the conversations","METHOD: Store a record in the MongoDB with all relevant fields","INPUT: The original message data and the reply from the brain. The following is","the data model for the objects to be stored in the DB:","    - Note, two of these will be stored. one for the user one for the both","    {","        timestamp : DateTime","        to : String","        from : String","        message : String","        arguments : Optional","    }","'''","def log(data) :","    #Send the original message to the MongoDB","    put.message(data)","    ","    #Construct the brain's reply","    document = {","        'timestamp' : str(datetime.datetime.utcnow()),","        'to' : data['from'],","        'from' : data['uuid'],","        'message' : data['message']","    }#No arguments","    ","    #Send brains reply","    put.message(document)"],"id":1982}],[{"start":{"row":28,"column":5},"end":{"row":29,"column":0},"action":"insert","lines":["",""],"id":1983},{"start":{"row":29,"column":0},"end":{"row":29,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":29,"column":4},"end":{"row":29,"column":8},"action":"insert","lines":["    "],"id":1984}],[{"start":{"row":29,"column":8},"end":{"row":29,"column":9},"action":"insert","lines":["'"],"id":1985}],[{"start":{"row":29,"column":9},"end":{"row":29,"column":10},"action":"insert","lines":["t"],"id":1986}],[{"start":{"row":29,"column":10},"end":{"row":29,"column":11},"action":"insert","lines":["i"],"id":1987}],[{"start":{"row":29,"column":11},"end":{"row":29,"column":12},"action":"insert","lines":["m"],"id":1988}],[{"start":{"row":29,"column":12},"end":{"row":29,"column":13},"action":"insert","lines":["e"],"id":1989}],[{"start":{"row":29,"column":9},"end":{"row":29,"column":13},"action":"remove","lines":["time"],"id":1990},{"start":{"row":29,"column":9},"end":{"row":29,"column":18},"action":"insert","lines":["timestamp"]}],[{"start":{"row":29,"column":18},"end":{"row":29,"column":19},"action":"insert","lines":["'"],"id":1991}],[{"start":{"row":29,"column":19},"end":{"row":29,"column":20},"action":"insert","lines":[" "],"id":1992}],[{"start":{"row":29,"column":20},"end":{"row":29,"column":21},"action":"insert","lines":["L"],"id":1993}],[{"start":{"row":29,"column":20},"end":{"row":29,"column":21},"action":"remove","lines":["L"],"id":1994}],[{"start":{"row":29,"column":20},"end":{"row":29,"column":21},"action":"insert","lines":[":"],"id":1995}],[{"start":{"row":29,"column":21},"end":{"row":29,"column":22},"action":"insert","lines":[" "],"id":1996}],[{"start":{"row":29,"column":22},"end":{"row":29,"column":23},"action":"insert","lines":["I"],"id":1997}],[{"start":{"row":29,"column":23},"end":{"row":29,"column":24},"action":"insert","lines":["S"],"id":1998}],[{"start":{"row":29,"column":24},"end":{"row":29,"column":25},"action":"insert","lines":["O"],"id":1999}],[{"start":{"row":29,"column":25},"end":{"row":29,"column":26},"action":"insert","lines":[" "],"id":2000}],[{"start":{"row":29,"column":26},"end":{"row":29,"column":27},"action":"insert","lines":["8"],"id":2001}],[{"start":{"row":29,"column":27},"end":{"row":29,"column":28},"action":"insert","lines":["6"],"id":2002}],[{"start":{"row":29,"column":28},"end":{"row":29,"column":29},"action":"insert","lines":["0"],"id":2003}],[{"start":{"row":29,"column":29},"end":{"row":29,"column":30},"action":"insert","lines":["1"],"id":2004}],[{"start":{"row":29,"column":30},"end":{"row":29,"column":31},"action":"insert","lines":[" "],"id":2005}],[{"start":{"row":29,"column":31},"end":{"row":29,"column":32},"action":"insert","lines":["U"],"id":2006}],[{"start":{"row":29,"column":32},"end":{"row":29,"column":33},"action":"insert","lines":["T"],"id":2007}],[{"start":{"row":29,"column":33},"end":{"row":29,"column":34},"action":"insert","lines":["C"],"id":2008}],[{"start":{"row":29,"column":34},"end":{"row":30,"column":0},"action":"insert","lines":["",""],"id":2009},{"start":{"row":30,"column":0},"end":{"row":30,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":30,"column":8},"end":{"row":30,"column":9},"action":"insert","lines":["'"],"id":2010}],[{"start":{"row":30,"column":9},"end":{"row":30,"column":10},"action":"insert","lines":["t"],"id":2011}],[{"start":{"row":30,"column":10},"end":{"row":30,"column":11},"action":"insert","lines":["o"],"id":2012}],[{"start":{"row":30,"column":11},"end":{"row":30,"column":12},"action":"insert","lines":[";"],"id":2013}],[{"start":{"row":30,"column":11},"end":{"row":30,"column":12},"action":"remove","lines":[";"],"id":2014}],[{"start":{"row":30,"column":11},"end":{"row":30,"column":12},"action":"insert","lines":["'"],"id":2015}],[{"start":{"row":30,"column":12},"end":{"row":30,"column":13},"action":"insert","lines":[" "],"id":2016}],[{"start":{"row":30,"column":13},"end":{"row":30,"column":14},"action":"insert","lines":[":"],"id":2017}],[{"start":{"row":30,"column":14},"end":{"row":30,"column":15},"action":"insert","lines":[" "],"id":2018}],[{"start":{"row":30,"column":15},"end":{"row":30,"column":16},"action":"insert","lines":["t"],"id":2019}],[{"start":{"row":30,"column":16},"end":{"row":30,"column":17},"action":"insert","lines":["o"],"id":2020}],[{"start":{"row":30,"column":17},"end":{"row":30,"column":18},"action":"insert","lines":[" "],"id":2021}],[{"start":{"row":30,"column":17},"end":{"row":30,"column":18},"action":"remove","lines":[" "],"id":2022}],[{"start":{"row":30,"column":16},"end":{"row":30,"column":17},"action":"remove","lines":["o"],"id":2023}],[{"start":{"row":30,"column":15},"end":{"row":30,"column":16},"action":"remove","lines":["t"],"id":2024}],[{"start":{"row":30,"column":15},"end":{"row":31,"column":0},"action":"insert","lines":["",""],"id":2025},{"start":{"row":31,"column":0},"end":{"row":31,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":31,"column":8},"end":{"row":31,"column":9},"action":"insert","lines":["'"],"id":2026}],[{"start":{"row":31,"column":9},"end":{"row":31,"column":10},"action":"insert","lines":["f"],"id":2027}],[{"start":{"row":31,"column":10},"end":{"row":31,"column":11},"action":"insert","lines":["r"],"id":2028}],[{"start":{"row":31,"column":11},"end":{"row":31,"column":12},"action":"insert","lines":["o"],"id":2029}],[{"start":{"row":31,"column":12},"end":{"row":31,"column":13},"action":"insert","lines":["m"],"id":2030}],[{"start":{"row":31,"column":13},"end":{"row":31,"column":14},"action":"insert","lines":["t"],"id":2031}],[{"start":{"row":31,"column":14},"end":{"row":31,"column":15},"action":"insert","lines":["'"],"id":2032}],[{"start":{"row":31,"column":14},"end":{"row":31,"column":15},"action":"remove","lines":["'"],"id":2033}],[{"start":{"row":31,"column":13},"end":{"row":31,"column":14},"action":"remove","lines":["t"],"id":2034}],[{"start":{"row":31,"column":13},"end":{"row":31,"column":14},"action":"insert","lines":["'"],"id":2035}],[{"start":{"row":31,"column":14},"end":{"row":31,"column":15},"action":"insert","lines":[" "],"id":2036}],[{"start":{"row":31,"column":15},"end":{"row":31,"column":16},"action":"insert","lines":[":"],"id":2037}],[{"start":{"row":47,"column":23},"end":{"row":47,"column":25},"action":"remove","lines":["to"],"id":2038},{"start":{"row":47,"column":23},"end":{"row":47,"column":24},"action":"insert","lines":["u"]}],[{"start":{"row":47,"column":24},"end":{"row":47,"column":25},"action":"insert","lines":["u"],"id":2039}],[{"start":{"row":47,"column":25},"end":{"row":47,"column":26},"action":"insert","lines":["i"],"id":2040}],[{"start":{"row":47,"column":26},"end":{"row":47,"column":27},"action":"insert","lines":["d"],"id":2041}],[{"start":{"row":0,"column":0},"end":{"row":56,"column":19},"action":"remove","lines":["from cobe.brain import Brain","import datetime","import os.path","","#Import different classes","import sys","sys.path.append('mongodb/')","import get, put","","'''","PURPOSE: retrieve the brain from the cache and download it if it isn't","METHOD: Download from mongodb atlas database","INPUT/OUTPUT: input is the uuid and output is the directory to the brain","'''","def cache(uuid) :","    directory = 'cache/' + uuid + '.brain'","    #Check if it's in our cache","    if os.path.exists(directory) :","        #It exists in our cache","        return directory","    #download from database and put into cache","    else :","        get.cache(uuid)","        return directory","'''","PURPOSE: to provide a chat relay for the chatbots","METHOD: Load brain from cache and query for message","INPUT/OUTPUT: Inputs and output are similar where they are both in this format:","    {","        'timestamp' : ISO 8601 UTC","        'to' : ","        'from' :","        'uuid' : String - UUID","        'message' : String - Message","    }","    ","    Creates the entry in a journal file","'''","def chat(data) :","    directory = cache(data['uuid'])","    b = Brain(directory)","    ","    reply = b.reply(data['message'])","    ","    response = {","        'timestamp' : str(datetime.datetime.utcnow()),","        'to' : data['from'],","        'from' : data['uuid'],","        'message' : reply,","        'uuid' : data['uuid'] ","    }","    ","    #Log into our journal","    put.message(data)","    put.message(response)","    ","    return response"],"id":2042},{"start":{"row":0,"column":0},"end":{"row":78,"column":25},"action":"insert","lines":["from cobe.brain import Brain","import datetime","import os.path","","#Import different classes","import sys","sys.path.append('mongodb/')","import get, put","","'''","PURPOSE: retrieve the brain from the cache and download it if it isn't","METHOD: Download from mongodb atlas database","INPUT/OUTPUT: input is the uuid and output is the directory to the brain","'''","def cache(uuid) :","    directory = 'cache/' + uuid + '.brain'","    #Check if it's in our cache","    if os.path.exists(directory) :","        #It exists in our cache","        return directory","    #download from database and put into cache","    else :","        get.cache(uuid)","        return directory","'''","PURPOSE: to provide a chat relay for the chatbots","METHOD: Load brain from cache and query for message","INPUT/OUTPUT: Inputs and output are similar where they are both in this format:","    {","        'uuid' : String - UUID","        'message' : String - Message","    }","    ","    Creates the entry in a journal file","'''","def chat(data) :","    directory = cache(data['uuid'])","    b = Brain(directory)","    ","    reply = b.reply(data['message'])","    ","    response = {","        'message' : reply,","        'uuid' : data['uuid'] ","    }","    ","    #Log into our journal","    log(data, reply)","    ","    return response","","'''","PURPOSE: Create a log for the conversations","METHOD: Store a record in the MongoDB with all relevant fields","INPUT: The original message data and the reply from the brain. The following is","the data model for the objects to be stored in the DB:","    - Note, two of these will be stored. one for the user one for the both","    {","        timestamp : DateTime","        to : String","        from : String","        message : String","        arguments : Optional","    }","'''","def log(data, reply) :","    #Send the original message to the MongoDB","    put.message(data)","    ","    #Construct the brain's reply","    document = {","        'timestamp' : str(datetime.datetime.utcnow()),","        'to' : data['from'],","        'from' : data['uuid'],","        'message' : reply","    }#No arguments","    ","    #Send brains reply","    put.message(document)"]}],[{"start":{"row":73,"column":12},"end":{"row":73,"column":13},"action":"remove","lines":["m"],"id":2043}],[{"start":{"row":73,"column":11},"end":{"row":73,"column":12},"action":"remove","lines":["o"],"id":2044}],[{"start":{"row":73,"column":10},"end":{"row":73,"column":11},"action":"remove","lines":["r"],"id":2045}],[{"start":{"row":73,"column":9},"end":{"row":73,"column":10},"action":"remove","lines":["f"],"id":2046}],[{"start":{"row":73,"column":9},"end":{"row":73,"column":10},"action":"insert","lines":["u"],"id":2047}],[{"start":{"row":73,"column":10},"end":{"row":73,"column":11},"action":"insert","lines":["u"],"id":2048}],[{"start":{"row":73,"column":11},"end":{"row":73,"column":12},"action":"insert","lines":["i"],"id":2049}],[{"start":{"row":73,"column":12},"end":{"row":73,"column":13},"action":"insert","lines":["d"],"id":2050}]]},"ace":{"folds":[],"scrolltop":360,"scrollleft":0,"selection":{"start":{"row":72,"column":28},"end":{"row":72,"column":28},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":23,"state":"start","mode":"ace/mode/python"}},"timestamp":1497413743702,"hash":"8f7459e4512a91b189f58bb3240342d6800acb8d"}